/**
 * 阶段 1：生成搜索关键词
 */
export function buildKeywordPrompt(text: string) {
  return `你是一个搜索专家。请将以下用户选中的文本转化为 3 个最有助于查证事实真相的中文搜索关键词。
  
用户文本："${text}"

要求：
1. 只输出关键词，用空格隔开。
2. 关键词要精准、中立，包含核心人物、事件、时间。
3. 严禁输出任何废话。

搜索关键词：`;
}

/**
 * 阶段 4：最终加权核查分析
 */
export function buildFinalAnalysisPrompt(text: string, sources: string) {
  return `你是一个专业的真相核查员。你的任务是基于我提供的高质量搜索结果（包含信源评分和网页全文），判断用户文本的真实性。

用户输入的文本：
"${text}"

查证证据（已按信源可信度标注）：
${sources}

请严格遵守以下输出规范，严禁使用任何 Markdown 符号（如 **、-、# 等），直接输出纯文本：

输出结构：
总结：[真实/虚假/待验证] (加粗)

核心分析：[综合高权重信源的深度分析，50字以内]

支持点：[基于权威信源的支持证据]

矛盾点：[不同信源间的冲突或反驳证据]

结论：[最终总结]

核查原则：
1. 权重越高的信源（1.0 > 0.5 > 0.2）越可信。
2. 若高权重信源明确辟谣，即使低权重信源都在传播，也应判定为虚假。
3. 必须在分析中体现对信源可靠性的考量。
4. 全文控制在 150 字以内。

请直接开始输出：`;
}

/**
 * 构建真相核查 Prompt - V5.0 用户友好版 (保留旧版兼容)
 */
export function buildPrompt(text: string, proSources: any[], conSources: any[]) {
  // ... 之前的逻辑保持不变，作为降级方案 ...
  const contextPro = proSources.map(r => `- [支持证据] ${r.title}: ${r.content || r.snippet}`).join('\n');
  const contextCon = conSources.map(r => `- [反驳证据] ${r.title}: ${r.content || r.snippet}`).join('\n');

  return `你是一个专业的真相核查员。你的任务是基于搜索结果，判断用户输入的文本是“真实”、“虚假”还是“待验证”。

用户输入的文本：
"${text}"

搜索到的证据：
${contextPro}
${contextCon}

请严格遵守以下输出规范，严禁使用 Markdown 符号（如 **、-、# 等），直接输出纯文本：

输出结构要求：
第一行：总结：[🟢 真实/🔴 虚假/🟡 待验证] 

核心分析：[简明扼要的分析，50字以内]

支持点：[列出支持的证据事实]

矛盾点：[列出反驳或冲突的证据事实]

结论：[最终的一句话总结]

注意事项：
1. 严禁使用任何星号 (*)、减号 (-)、井号 (#)。
2. 每个部分之间必须保留一个空行。
3. 文案要口语化、专业且易懂，不要像程序员的日志。
4. 全文控制在 150 字以内。

请直接开始输出：`;
}
